<!DOCTYPE html>
<html lang="en-US">
    <head>

    <style>
    @import url(http://fonts.googleapis.com/css?family=Yeseva+One|Open+Sans);

        body {
            font-family: 'Open Sans', sans-serif;
            margin: 0px;
            background-color: white;
        }

        h1 {
            font-size: 3em;
            font-family: 'Yeseva One', cursive;
            color: #FF3300;
        }

        #logo {
            position: fixed;
            top: 4px;
            left: 24px;
            margin-top: -20px;
        }

        #key {
            font-size: .8em;
            text-align: left;
            position: fixed;
            top: 4px;
            left: 24px;
            margin-top: 86px;
        }

        #date {
            font-size: .6em;
        }
    
        #stream {
            position: fixed;
            bottom: 12px;
            right: 8px;
        }

        #about {
            font-size: .6em;
            position: fixed;
            bottom: -6px;
            right: 0px;
        }
    
        #adsense {
            position: fixed;
            bottom: 6px;
            left: 6px;
            width: 240px;
            height: 66px;
        }

        @media screen and (max-width: 719px) {

            h1 {
                font-size: 1.2em;
            }

            #logo {
                position: fixed;
                top: 2px;
                margin-top: 0px;
            }

            #subtitle {
                display: none;
            }

            #key {
                display: none;
            }

            #date {
                display: none;
            }

            #adsense {
                display: none;
            }

        }
    </style>

    <meta charset="utf-8">
    <meta name="description" content="A beautiful HTML5 streaming audio player for NPR's 24 hour news">
    <meta name="keywords" content="NPR, News, Radio, Public Radio, HTML5, Streaming">
    <meta name="author" content="Agent L Productions | agentl.productions">
    <title>NPR Today</title>
    <link rel="shortcut icon" href="img/favicon.png" type="image/png">
    <meta name="viewport" content="initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, width=device-width, user-scalable=no">
    <link rel="apple-touch-icon" href="img/nprtoday.png" />
    <link rel="apple-touch-icon-precomposed" href="img/nprtoday.png" />
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-title" content="NPR Today">
    <link rel="shortcut icon" sizes="256x256" href="img/nprtoday.png">
    <meta name="mobile-web-app-capable" content="yes">

    <script type="text/javascript">

    function getWindowSize() {
        var myWidth;
        var myHeight;

        if( typeof( window.innerWidth ) == 'number' ) { 
            //Non-IE 
            myWidth = window.innerWidth;
            myHeight = window.innerHeight; 
        } else if( document.documentElement && ( document.documentElement.clientWidth || document.documentElement.clientHeight ) ) { 
            //IE 6+ in 'standards compliant mode' 
            myWidth = document.documentElement.clientWidth; 
            myHeight = document.documentElement.clientHeight; 
        } else if( document.body && ( document.body.clientWidth || document.body.clientHeight ) ) { 
            //IE 4 compatible 
            myWidth = document.body.clientWidth; 
            myHeight = document.body.clientHeight; 
        }
    
        return [myWidth,myHeight];
    }

    waitForIt = null;

    function setbkg(){

        /* ====================================================================
            http://www.npr.org/audiohelp/progstream.html
         ==================================================================== */ 

        var paddingTop = 380; // from the TOP of the IMAGE to the BORDER of the CLOCK
        var outerHand = 20; // from the TOP of the 'outer' HAND to the BORDER of the CLOCK
        var fullHandSize = 1000; // from the TOP of the 'outer' HAND to the CENTER of the CLOCK

        // schedule, starting with Sunday, ex. [[pic.png,#ofdays],[pic.png,#ofdays]], 
        var program = [
            [['other2014.png',1],['me2014.png',5],['other2014.png',1]],
            [['other2014.png',1],['me2014.png',5],['other2014.png',1]],
            [['other2014.png',1],['atc2014.png',5],['other2014.png',1]],
            [['other2014.png',1],['atc2014.png',5],['other2014.png',1]],
            [['other2014.png',7]],
            [['other2014.png',7]],
            [['other2014.png',1],['atc2014.png',5],['other2014.png',1]],
            [['other2014.png',1],['atc2014.png',5],['other2014.png',1]],
            [['other2014.png',7]],
            [['other2014.png',7]],
            [['other2014.png',7]],
            [['other2014.png',7]],
            [['other2014.png',1],['me2014.png',5],['other2014.png',1]],
            [['other2014.png',1],['me2014.png',5],['other2014.png',1]],
            [['other2014.png',7]],
            [['other2014.png',7]],
            [['other2014.png',7]],
            [['other2014.png',7]],
            [['other2014.png',7]],
            [['other2014.png',7]],
            [['other2014.png',7]],
            [['other2014.png',7]],
            [['other2014.png',1],['atc2014.png',5],['other2014.png',1]],
            [['other2014.png',1],['atc2014.png',5],['other2014.png',1]],
        ];

        var d = new Date();
        // getting the array for this hour
        var h = d.getHours();
        var thisHour = program[h];

        var img = null;

        // if this hour is not yet configured
        if (!thisHour) {
            console.error('The hour '+h+' is not configured yet.');
        } else {
            // if it is
            var dayImg = [];
            // running each position on the array for this hour of the day
            for (i in thisHour) {
                // getting the position
                var cfg = thisHour[i];
                // running for 1 to the number-of-days of this position
                for (var j = 1; j <= cfg[1]; j++) {
                    // adding the image code for this day;
                    dayImg.push(cfg[0]);
                }
            }
            /* 
                    [['code1',1],['code2',4],['code3',2]] -> 
                    ['code1','code2','code2','code2','code2','code3','code3']
            */
            var w = d.getDay();
            img = dayImg[w]; // like this        
        }

        if (!img) img = 'i.imgur.com/wNOr5VU.png';

        var fakeImg = new Image();    
        fakeImg.onload = function() {
            // getting the size of the window
            var winsize = getWindowSize();
            var win_w = winsize[0];
            var win_h = winsize[1];

            // getting the ratio of the original image
            var ratio_wh = this.width/this.height;
            var ratio_hw = this.height/this.width;

            // calculating the new size of the img
            var div_w = 0;
            var div_h = 0;
            if (win_w > win_h) {
                div_h = win_h-5;
                div_w = div_h*ratio_wh;
            } else {
                div_w = win_w-5;
                div_h = div_w*ratio_hw;
            }

            // getting the changing ratio
            var ratioH = div_h/this.height;

            paddingTop *= ratioH; 
            outerHand *= ratioH;
            fullHandSize *= ratioH;

            // updating the size of the container
            var div = document.getElementById('divContainer');
            div.style.height = div_h+'px';
            div.style.width = div_w+'px';

            // updating the size of the image
            var imgBg = document.getElementById('myBkg');
            imgBg.style.height = div_h+'px';
            imgBg.style.width = div_w+'px';

            // updating the position of the hand
            var hand = document.getElementById('minuteHand');
            // centering the hand horizontally
            var left = div_w/2;
            hand.style.left = left+'px';        
        
            // adjusting the distance from the top
            hand.style.top = Math.round(paddingTop - outerHand)+'px';

            // adjusting the height of the hand    
            hand.style.height = Math.round(fullHandSize)+'px';
            hand.style.WebkitTransformOrigin = "center bottom";
            hand.style.MozTransformOrigin = "center bottom";

            // after the fakeImg is loaded, then we update the real one
            imgBg.src = this.src;
        };

        // we need to create a fake image to get its size and adjust everything
        fakeImg.src = 'http://npr.today/img/'+img;

        // we'll check again every 5 seconds 
        clearTimeout(waitForIt);
        waitForIt = setTimeout(setbkg,1000*5);

        // updating the minute hand
        updateMinuteHand();
    }

    delayMinuteHand = null;

    function updateMinuteHand() {
        var d = new Date();
        var m = d.getMinutes();
        var s = d.getSeconds();

        var radMinute = 360/60;
        var radSecond = radMinute/60;

        // if you do NOT want the hand to move as the seconds go, just set 'radSecond' to zero

        var radius = radMinute*m + radSecond*s;

        var hand = document.getElementById('minuteHand');
        hand.style.WebkitTransform = "rotate("+radius+"deg)";
        hand.style.MozTransform = "rotate(" + radius + "deg)";

        clearTimeout(delayMinuteHand);     
        delayMinuteHand = setTimeout(updateMinuteHand,1000);
    }

    </script>

    <script src="a2h/add2home.js"></script>
    <link rel="stylesheet" type="text/css" href="a2h/add2home.css">
    <script>
        addToHomescreen({
        skipFirstVisit: true,
        maxDisplayCount: 1
        onAdd: function () {
              ga('send', 'event', 'addtohomescreen', 'yes');
            }
        });
    </script>
    
    <script>
          (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
          (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
          })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

          ga('create', 'UA-51976003-1', 'auto');
          ga('require', 'displayfeatures');
          ga('send', 'pageview');
    </script>

    </head>

    <body onload='setbkg()' onresize='setbkg()'>
        <center>
            <div id='divContainer' style='position:relative'>
                <img id='myBkg' style='position:absolute;top:0px;right:8px'/>
                <div id='minuteHand' style='position:absolute;top:0px;left:0px;background:red;width:2px;WebkitTransformOrigin:0 0;MozTransformOrigin:0 0;'></div>
            </div>
            <div id="logo">
                <h1>NPR <span style="color:#3266CC;">Today</span></h1>
                <p id="subtitle" style="margin-top:-40px;margin-left:-60px;">An hourly NPR News clock</p>
                <p id="key">
                    <span style="font-size:2em;line-height:70%;color:#C0C0C2;">&#9632;</span> - Segment<br />
                    <span style="font-size:2em;line-height:70%;color:#231F20;">&#9632;</span> - Newscast<br />
                    <span style="font-size:2em;line-height:70%;color:#7EB3D2;">&#9632;</span> - Promo<br />
                    <span style="font-size:2em;line-height:70%;color:#73A1AD;">&#9632;</span> - Music Bed<br />
                    <span style="font-size:2em;line-height:70%;color:#EE2A2C;">&#9632;</span> - Funding Credit<br />
                </p>
            </div>
            <div id="about">
                <p><a href="/about">About this site...</a></p>
            </div>
            <div id="stream">
                <audio src="//nprdmp.ic.llnwd.net/stream/nprdmp_live01_mp3" type="audio/mpeg" autoplay controls>
                Please <a href="http://browsehappy.com/" target="_blank">update your browser</a> to a modern browser in order to play audio        
                </audio>
            </div>
            <div id="adsense">
                <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
                <ins class="adsbygoogle"
                     style="display:inline-block;width:234px;height:60px"
                     data-ad-client="ca-pub-9544720367752359"
                     data-ad-slot="5365959101"></ins>
                <script>
                (adsbygoogle = window.adsbygoogle || []).push({});
                </script>
            </div>
        </center>
    </body>

</html>
